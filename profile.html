<!DOCTYPE html>
<html>
<head>
  <title>User Profile</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body style="font-family:sans-serif;padding:2rem;">
  <h1>Profile</h1>
  <div id="profileContainer">Loading...</div>

  <!-- Toast styles -->
  <style>
    .toast {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: #222;
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 0.95rem;
      z-index: 9999;
      box-shadow: 0 0 10px rgba(0,0,0,0.4);
      opacity: 0;
      transform: translateY(20px);
      animation: toast-in 0.4s forwards, toast-out 0.4s 3s forwards;
    }
    @keyframes toast-in {
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes toast-out {
      to { opacity: 0; transform: translateY(20px); }
    }
  </style>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    const supabase = createClient('https://rdomgvvjbjfrvkbhjxds.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJkb21ndnZqYmpmcnZrYmhqeGRzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM2MjY5NTEsImV4cCI6MjA2OTIwMjk1MX0.3CMfwZ_HocNzkyvuYjvFL3lypZX2JL2kXvk3kL5AB54');

    function showToast(msg, color = '#222') {
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.textContent = msg;
      toast.style.background = color;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 4000);
    }

    const urlParams = new URLSearchParams(window.location.search);
    const googleId = urlParams.get('id');

    if (!googleId) {
      showToast("No ID provided", "red");
      document.getElementById("profileContainer").innerText = "No ID in URL.";
      throw new Error("Missing id param");
    }

    async function loadProfile() {
      const { data: user, error } = await supabase
        .from('users')
        .select('*')
        .eq('google_id', googleId)
        .single();

      if (error) {
        showToast("Profile not found", "#e74c3c");
        document.getElementById("profileContainer").innerText = "Profile not found.";
        return;
      }

      document.getElementById("profileContainer").innerHTML = `
        <img src="${user.avatar_url}" width="80" height="80" style="border-radius:50%"><br>
        <strong>${user.username}</strong><br>
        <p><strong>Bio:</strong> ${user.bio}</p>
        <p><strong>Balance:</strong> $${user.balance}</p>
        <p><strong>Streak:</strong> ${user.streak} days</p>
        <p><strong>Badges:</strong> ${user.badges.join(', ') || 'None'}</p>
        <p><strong>Verified:</strong> ${user.verified ? '✅' : '❌'}</p>
        <p><strong>Last Claimed:</strong> ${user.last_claimed ? new Date(user.last_claimed).toLocaleString() : 'Never'}</p>
      `;
    }

    loadProfile();
  </script>
</body>
</html>
