<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MiniTopia Utilities | Enhanced Control Panel</title>
    <style>
        :root {
            --primary-dark: #0a1128;
            --primary-blue: #1a2a6c;
            --accent-blue: #3a7bd5;
            --highlight: #00d2ff;
            --text-light: #f8f9fa;
        }
        
        body {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-blue));
            color: var(--text-light);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeIn 0.8s ease-out forwards;
        }
        
        @keyframes fadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid rgba(58, 123, 213, 0.3);
            margin-bottom: 2rem;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(to right, var(--accent-blue), var(--highlight));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }
        
        .sidebar {
            background: rgba(10, 17, 40, 0.7);
            border-radius: 10px;
            padding: 1.5rem;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transform: translateX(-20px);
            opacity: 0;
            animation: slideIn 0.6s ease-out 0.2s forwards;
        }
        
        @keyframes slideIn {
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .sidebar-item {
            padding: 0.8rem 1rem;
            margin: 0.5rem 0;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }
        
        .sidebar-item:hover {
            background: rgba(58, 123, 213, 0.2);
            transform: translateX(5px);
        }
        
        .sidebar-item.active {
            background: linear-gradient(to right, rgba(58, 123, 213, 0.4), transparent);
            border-left: 3px solid var(--highlight);
        }
        
        .main-content {
            background: rgba(10, 17, 40, 0.7);
            border-radius: 10px;
            padding: 2rem;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transform: translateY(20px);
            opacity: 0;
            animation: slideUp 0.6s ease-out 0.4s forwards;
        }
        
        @keyframes slideUp {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: rgba(26, 42, 108, 0.5);
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(58, 123, 213, 0.2);
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 210, 255, 0.1);
            border-color: rgba(0, 210, 255, 0.4);
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 0.5rem 0;
            background: linear-gradient(to right, var(--accent-blue), var(--highlight));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .command-list {
            margin-top: 2rem;
        }
        
        .command-item {
            background: rgba(26, 42, 108, 0.3);
            border-radius: 8px;
            padding: 1rem 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }
        
        .command-item:hover {
            background: rgba(26, 42, 108, 0.5);
            border-left: 3px solid var(--highlight);
            transform: translateX(5px);
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
            float: right;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background: linear-gradient(to right, var(--accent-blue), var(--highlight));
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        .ripple {
            position: absolute;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.7);
            transform: scale(0);
            animation: ripple 0.6s linear;
            pointer-events: none;
        }
        
        @keyframes ripple {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }
        
        .floating-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .particle {
            position: absolute;
            background: rgba(0, 210, 255, 0.5);
            border-radius: 50%;
            animation: float linear infinite;
        }
        
        @keyframes float {
            0% { transform: translateY(0) rotate(0deg); }
            100% { transform: translateY(-100vh) rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="floating-particles" id="particles"></div>
    
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2L2 7L12 12L22 7L12 2Z" fill="white" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M2 17L12 22L22 17" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M2 12L12 17L22 12" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                <h1>MiniTopia Utilities</h1>
            </div>
            <div id="user-info" style="display: none;">
  Logged in as <span id="user-name"></span>
</div>

<button id="login-button" style="display: none;">Login with Discord</button>
<button id="logout-button" style="display: none;">Logout</button
        </header>
        
        <div class="dashboard">
            <div class="sidebar">
                <div class="sidebar-item active">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 12L5 10M5 10L12 3L19 10M5 10V20C5 20.5523 5.44772 21 6 21H9M19 10L21 12M19 10V20C19 20.5523 18.5523 21 18 21H15M9 21C9.55228 21 10 20.5523 10 20V16C10 15.4477 10.4477 15 11 15H13C13.5523 15 14 15.4477 14 16V20C14 20.5523 14.4477 21 15 21M9 21H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Dashboard
                </div>
                <div class="sidebar-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10.325 4.317C10.751 2.561 13.249 2.561 13.675 4.317C13.861 5.104 14.637 5.611 15.433 5.481C17.25 5.201 18.553 6.993 17.648 8.464C17.135 9.294 17.42 10.37 18.191 10.882C19.661 11.788 19.661 14.212 18.191 15.118C17.42 15.63 17.135 16.706 17.648 17.536C18.553 19.007 17.25 20.799 15.433 20.519C14.637 20.389 13.861 20.896 13.675 21.683C13.249 23.439 10.751 23.439 10.325 21.683C10.139 20.896 9.363 20.389 8.567 20.519C6.75 20.799 5.447 19.007 6.352 17.536C6.865 16.706 6.58 15.63 5.809 15.118C4.339 14.212 4.339 11.788 5.809 10.882C6.58 10.37 6.865 9.294 6.352 8.464C5.447 6.993 6.75 5.201 8.567 5.481C9.363 5.611 10.139 5.104 10.325 4.317Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Bot Settings
                </div>
                <div class="sidebar-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9 12H15M9 8H15M9 16H12M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Commands
                </div>
                <div class="sidebar-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M18 8C19.6569 8 21 6.65685 21 5C21 3.34315 19.6569 2 18 2C16.3431 2 15 3.34315 15 5C15 6.65685 16.3431 8 18 8Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M6 15C7.65685 15 9 13.6569 9 12C9 10.3431 7.65685 9 6 9C4.34315 9 3 10.3431 3 12C3 13.6569 4.34315 15 6 15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M18 22C19.6569 22 21 20.6569 21 19C21 17.3431 19.6569 16 18 16C16.3431 16 15 17.3431 15 19C15 20.6569 16.3431 22 18 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M8.58984 13.5098L15.4198 17.4898" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M15.4098 6.50977L8.58984 10.4898" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Modules
                </div>
                <div class="sidebar-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M21 12C21 13.1819 20.7672 14.3522 20.3149 15.4442C19.8626 16.5361 19.1997 17.5282 18.364 18.364C17.5282 19.1997 16.5361 19.8626 15.4442 20.3149C14.3522 20.7672 13.1819 21 12 21C10.8181 21 9.64778 20.7672 8.55585 20.3149C7.46392 19.8626 6.47177 19.1997 5.63604 18.364C4.80031 17.5282 4.13738 16.5361 3.68508 15.4442C3.23279 14.3522 3 13.1819 3 12C3 9.61305 3.94821 7.32387 5.63604 5.63604C7.32387 3.94821 9.61305 3 12 3C14.3869 3 16.6761 3.94821 18.364 5.63604C20.0518 7.32387 21 9.61305 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 7V12L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Logs
                </div>
                <div class="sidebar-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10.05 4.575C10.475 2.825 13.525 2.825 13.95 4.575C14.135 5.3625 14.9125 5.875 15.7125 5.7375C17.5375 5.4625 18.8375 7.2625 17.925 8.7375C17.4125 9.575 17.7 10.65 18.475 11.1625C19.95 12.075 19.95 14.5125 18.475 15.425C17.7 15.9375 17.4125 17.0125 17.925 17.85C18.8375 19.325 17.5375 21.125 15.7125 20.85C14.9125 20.7125 14.135 21.225 13.95 22.0125C13.525 23.7625 10.475 23.7625 10.05 22.0125C9.865 21.225 9.0875 20.7125 8.2875 20.85C6.4625 21.125 5.1625 19.325 6.075 17.85C6.5875 17.0125 6.3 15.9375 5.525 15.425C4.05 14.5125 4.05 12.075 5.525 11.1625C6.3 10.65 6.5875 9.575 6.075 8.7375C5.1625 7.2625 6.4625 5.4625 8.2875 5.7375C9.0875 5.875 9.865 5.3625 10.05 4.575Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Advanced
                </div>
            </div>
            
            <div class="main-content">
                <h2>Dashboard Overview</h2>
                <p class="subtitle">Welcome back! Here's what's happening with your bot.</p>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Servers</div>
                        <div class="stat-value">128</div>
                        <div class="stat-desc">+12 this week</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Users</div>
                        <div class="stat-value">5.2K</div>
                        <div class="stat-desc">+342 today</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Commands</div>
                        <div class="stat-value">47</div>
                        <div class="stat-desc">3 new</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Uptime</div>
                        <div class="stat-value">99.8%</div>
                        <div class="stat-desc">Last 30 days</div>
                    </div>
                </div>
                
                <div class="command-list">
                    <h3>Recently Used Commands</h3>
                    
                    <div class="command-item">
                        <div class="command-name">/moderate kick</div>
                        <div class="command-usage">Used 142 times today</div>
                        <label class="toggle-switch">
                            <input type="checkbox" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="command-item">
                        <div class="command-name">/fun meme</div>
                        <div class="command-usage">Used 89 times today</div>
                        <label class="toggle-switch">
                            <input type="checkbox" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="command-item">
                        <div class="command-name">/utility poll</div>
                        <div class="command-usage">Used 67 times today</div>
                        <label class="toggle-switch">
                            <input type="checkbox" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

<script>
  // ✅ Supabase setup
  const supabase = supabase.createClient(
    "https://rdomgvvjbjfrvkbhjxds.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJkb21ndnZqYmpmcnZrYmhqeGRzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM2MjY5NTEsImV4cCI6MjA2OTIwMjk1MX0.3CMfwZ_HocNzkyvuYjvFL3lypZX2JL2kXvk3kL5AB54"
  );

  // ✅ Discord OAuth2 info
  const DISCORD_CLIENT_ID = "1397532697655775282";
  const REDIRECT_URI = window.location.origin;
  const SCOPES = "identify guilds";
  const AUTH_URL = `https://discord.com/api/oauth2/authorize?client_id=${DISCORD_CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&response_type=token&scope=${SCOPES}`;

  // ✅ Elements
  const loginBtn = document.getElementById("login-button");
  const logoutBtn = document.getElementById("logout-button");
  const usernameDisplay = document.getElementById("user-name");

  // ✅ Handle login redirect
  function handleDiscordLogin() {
    window.location.href = AUTH_URL;
  }

  // ✅ Get token from URL hash
  function getTokenFromHash() {
    const hash = window.location.hash;
    if (!hash) return null;
    const params = new URLSearchParams(hash.substring(1));
    return params.get("access_token");
  }

  // ✅ Fetch user info
  async function fetchDiscordUser(token) {
    const res = await fetch("https://discord.com/api/users/@me", {
      headers: { Authorization: `Bearer ${token}` },
    });
    if (!res.ok) return null;
    return await res.json();
  }

  // ✅ Logout
  function logout() {
    localStorage.removeItem("discord_token");
    location.reload();
  }

  // ✅ Init app
  async function init() {
    // Try load from localStorage first
    let token = localStorage.getItem("discord_token");

    // If not in localStorage, check URL hash
    if (!token) {
      token = getTokenFromHash();
      if (token) {
        localStorage.setItem("discord_token", token);
        window.location.hash = ""; // clean URL
      }
    }

    if (!token) {
      loginBtn.style.display = "block";
      logoutBtn.style.display = "none";
      return;
    }

    // Try to get user
    const user = await fetchDiscordUser(token);
    if (!user) {
      logout();
      return;
    }

    // Show user info
    document.getElementById("user-info").style.display = "flex";
    usernameDisplay.textContent = user.username + "#" + user.discriminator;
    loginBtn.style.display = "none";
    logoutBtn.style.display = "block";

    // Optional: You could now use Supabase to read user settings:
    // const { data, error } = await supabase.from('users').select('*').eq('id', user.id)
  }

  // Hook buttons
  loginBtn?.addEventListener("click", handleDiscordLogin);
  logoutBtn?.addEventListener("click", logout);

  // Start
  init();
</script>
</body>
</html>
